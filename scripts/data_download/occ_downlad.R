#' This script requires `ndop` Python library (`pip install 
#' ndop-downloader`) and ISOP AOPK CR account (free registration), see 
#' https://pypi.org/project/ndop-downloader/ or
#' https://github.com/OpenGeoLabs/qgis-ndop-downloader.

species <- "Ruspolia nitidula"

ndop_dir <- file.path("..","..","source_data","ndop")
dir.create(ndop_dir,showWarnings=F)


system(paste0('ndop --taxon "',species,'" --output "',ndop_dir,'/ruspolia_ndop"'))

unlink(list.files(ndop_dir,pattern="ruspolia_ndop_shp",full.name=T))

# get occurences that were available in time of conducting study
ndop_tab <- read.csv(file.path(ndop_dir,"ruspolia_ndop_tab.csv"))

ids <- c(50081319,50004556,49945094,49930011,49929346,49929291,49928909,49928880,49921009,49920898,49907266,49907265,49897066,49888668,49870725,49855198,49832752,49808995,49808975,49808954,49808934,49808913,49808815,49808800,49804111,48858261,48836048,48834840,48834778,48789893,48050986,48050953,48050916,47746350,47746317,47746285,47746279,47641363,47641356,47641325,47630542,47622475,46686840,46686819,46559999,46559993,46559991,46558855,46558640,46558612,46558471,46558328,46558318,46338676,46338655,46338640,46338581,46337685,46337674,46337621,46337588,46337575,46337563,46337493,46337399,46337359,46337349,46337324,46337260,46337205,46337164,46337111,45534318,45523788,45488802,45479457,45475109,45475088,45475081,45475065,45422941,43432349,41998542,39186389,39167775,39167773,39167762,39167756,39167745,37216334,33675004,33647090,32374770,32363932,32363931,31320417,23391472,3009766)

ndop_tab <- ndop_tab[ndop_tab$ID_NALEZ %in% ids,]
names(ndop_tab)
write.csv(ndop_tab,file.path(ndop_dir,"ruspolia_ndop_tab.csv"), row.names=FALSE)
